<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=&sensor=false"></script>
    <script type="text/javascript" src="js/jquery-1.8.1.min.js"></script>
    <script type="text/javascript" id="testscript" src="js/html2canvas.js"></script>
    <script type="text/javascript" src="js/jquery.plugin.html2canvas.js"></script>
    <script type="text/javascript" src="js/BlobBuilder.js"></script>
    <script type="text/javascript" src="js/FileSaver.js"></script>
    <script type="text/javascript" src="js/canvas-toBlob.js"></script>
    <script type="text/javascript">
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(37.777499,-122.421538),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
      }
      function snap()
      {
      	var filename = $("#filename").val()==""? "ortho" : $("#filename").val() ;
      	var html2obj = html2canvas($('#map_canvas'), {logging: true, useCORS: true, allowTaint: false, onrendered: function(canvas){
      		//ortho download
			canvas.toBlob(function(blob){ saveAs(blob, filename+".jpg")}, "image/jpeg", 0.99);
	
			//World file download
      		var bb = new BlobBuilder;
      		bb.append("worldfile");
      		saveAs(bb.getBlob("text/plain"), filename+".jgw");
      		
      		//PRJ file download
      		bb = new BlobBuilder;
      		bb.append("prj");
      		saveAs(bb.getBlob("text/plain"), filename+".prj");
      		}}) ;

      }
    </script>
  </head>
  <body onload="initialize()">
  	<div id="controls" style="width:100%; height:5%">
  		<input type="text" name="filename" id="filename" value="ortho"/>.jpg<button id="snap" onclick="snap();">Snap!</button>
  	</div>
    <div id="map_canvas" style="width:100%; height:95%"></div>
    <div><img id="ortho" src="" /></div>
    <div id="test"></div>
  </body>
</html>